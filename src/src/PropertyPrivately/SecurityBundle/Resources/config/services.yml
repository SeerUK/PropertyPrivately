parameters:
    # Builders
    pp_security.token_builder.class: PropertyPrivately\SecurityBundle\Token\Builder\TokenBuilder

    # Entities
    pp_security.application.class: PropertyPrivately\SecurityBundle\Entity\Application
    pp_security.token.class: PropertyPrivately\SecurityBundle\Entity\Token
    pp_security.user.class: PropertyPrivately\SecurityBundle\Entity\User

    # Generators
    pp_security.token_generator.class: PropertyPrivately\SecurityBundle\Token\Utils\TokenGenerator

    # Repos
    pp_security.application_repository.class: Doctrine\ORM\EntityRepository
    pp_security.token_repository.class: PropertyPrivately\SecurityBundle\Entity\TokenRepository
    pp_security.user_repository.class: PropertyPrivately\SecurityBundle\Entity\UserRepository

    # Resource Assemblers
    pp_security.resource_assembler.token.get_all_assembler.class: PropertyPrivately\SecurityBundle\Resource\Assembler\Token\GetAllResourceAssembler
    pp_security.resource_assembler.token.get_assembler.class: PropertyPrivately\SecurityBundle\Resource\Assembler\Token\GetResourceAssembler
    pp_security.resource_assembler.token_assembler.class: PropertyPrivately\SecurityBundle\Resource\Assembler\TokenResourceAssembler
    pp_security.resource_assembler.user_assembler.class: PropertyPrivately\SecurityBundle\Resource\Assembler\UserResourceAssembler

    # Security
    pp_security.user_provider.class: PropertyPrivately\SecurityBundle\User\UserProvider
    pp_security.apikey_user_provider.class: PropertyPrivately\SecurityBundle\User\ApiKeyUserProvider
    pp_security.apikey_authenticator.class: PropertyPrivately\SecurityBundle\Authentication\ApiKeyAuthenticator
    pp_security.apikey_authenticated_voter.class: PropertyPrivately\SecurityBundle\Authorization\Voter\ApiKeyAuthenticatedVoter

    # Validators
    pp_security.user_validator.class: PropertyPrivately\SecurityBundle\Validator\UserValidator

services:
    # Builders
    pp_security.token_builder:
        class: %pp_security.token_builder.class%
        arguments:
            - "@pp_security.application_repository"
            - "@pp_security.token_repository"
            - "@pp_security.user_repository"
            - "@pp_security.user_validator"
            - "@pp_security.token_generator"

    # Generators
    pp_security.token_generator:
        class: %pp_security.token_generator.class%

    # Repos
    pp_security.application_repository:
        class: %pp_security.application_repository.class%
        factory_service: doctrine.orm.entity_manager
        factory_method: getRepository
        arguments:
            - %pp_security.application.class%

    pp_security.token_repository:
        class: %pp_security.token_repository.class%
        factory_service: doctrine.orm.entity_manager
        factory_method: getRepository
        arguments:
            - %pp_security.token.class%

    pp_security.user_repository:
        class: %pp_security.user_repository.class%
        factory_service: doctrine.orm.entity_manager
        factory_method: getRepository
        arguments:
            - %pp_security.user.class%

    # Resource Assemblers
    pp_security.resource_assembler.token.get_all_assembler:
        class: %pp_security.resource_assembler.token.get_all_assembler.class%
        arguments:
            - "@router"
        calls:
            - [setRootResource, ["@seer_uk_rest.hal_root_resource"]]
            - [setSubAssembler, ["token", "@pp_security.resource_assembler.token_assembler"]]

    pp_security.resource_assembler.token.get_assembler:
        class: %pp_security.resource_assembler.token.get_assembler.class%
        arguments:
            - "@router"
        calls:
            - [setRootResource, ["@seer_uk_rest.hal_root_resource"]]
            - [setSubAssembler, ["token", "@pp_security.resource_assembler.token_assembler"]]

    pp_security.resource_assembler.token_assembler:
        class: %pp_security.resource_assembler.token_assembler.class%
        arguments:
            - "@router"
        calls:
            - [setSubAssembler, ["user", "@pp_security.resource_assembler.user_assembler"]]

    pp_security.resource_assembler.user_assembler:
        class: %pp_security.resource_assembler.user_assembler.class%
        arguments:
            - "@router"

    # Security
    pp_security.user_provider:
        class: %pp_security.user_provider.class%
        arguments:
            - "@pp_security.user_repository"

    pp_security.apikey_user_provider:
        class: %pp_security.apikey_user_provider.class%
        arguments:
            - "@pp_security.user_provider"
            - "@pp_security.token_repository"

    pp_security.apikey_authenticator:
        class: %pp_security.apikey_authenticator.class%
        arguments:
            - "@pp_security.apikey_user_provider"

    pp_security.apikey_authenticated_voter:
        class: %pp_security.apikey_authenticated_voter.class%
        arguments:
            - "@security.authentication.trust_resolver"
        public:     false
        tags:
            - { name: security.voter }

    # Validator
    pp_security.user_validator:
        class: %pp_security.user_validator.class%
        arguments:
            - "@security.encoder_factory"
